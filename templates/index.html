<!DOCTYPE html>
<html lang="tr">
  <head>
    <meta charset="UTF-8" />
    <title>Crypto Dashboard</title>
    <script src="https://cdn.socket.io/4.0.0/socket.io.min.js"></script>
    <style>
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }
      body {
        font-family: "Segoe UI", sans-serif;
        height: 100vh;
        display: flex;
        background: #e5ddd5;
        overflow: hidden;
      }

      .sidebar {
        width: 45%;
        background: #fff;
        border-right: 2px solid #ddd;
        display: flex;
        flex-direction: column;
      }
      .sidebar-header {
        padding: 20px;
        background: #075e54;
        color: white;
        text-align: center;
      }

      .menu-grid {
        padding: 20px;
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 10px;
        overflow-y: auto;
      }

      .btn-alg {
        padding: 15px;
        border-radius: 8px;
        color: white;
        cursor: pointer;
        font-weight: bold;
        text-align: center;
        font-size: 14px;
        user-select: none;
        transition: transform 0.1s;
      }
      .btn-alg:active {
        transform: scale(0.98);
      }
      .btn-monitor {
        background: #2c3e50;
        grid-column: span 2;
        margin-bottom: 20px;
      }

      .iframe-view {
        width: 100%;
        height: 100%;
        border: none;
        display: none;
        flex-grow: 1;
      }

      .chat-panel {
        width: 55%;
        display: flex;
        flex-direction: column;
        background: #efe7dd;
      }
      .chat-header {
        padding: 15px;
        background: #075e54;
        color: white;
        display: flex;
        justify-content: space-between;
      }
      #chat-window {
        flex-grow: 1;
        padding: 20px;
        overflow-y: auto;
        display: flex;
        flex-direction: column;
        gap: 10px;
      }

      .bubble {
        max-width: 85%;
        padding: 10px 15px;
        border-radius: 10px;
        font-size: 14px;
        position: relative;
        box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
      }
      .client-msg {
        align-self: flex-end;
        background: #dcf8c6;
        border: 1px solid #c7e9a9;
      }
      .server-msg {
        align-self: flex-start;
        background: #fff;
        border: 1px solid #ddd;
      }

      .tag {
        font-size: 10px;
        font-weight: bold;
        display: block;
        margin-bottom: 4px;
        text-transform: uppercase;
        color: #555;
      }
      .meta {
        font-size: 10px;
        color: #999;
        margin-top: 5px;
        text-align: right;
        display: block;
      }
    </style>
  </head>
  <body>
    <div class="sidebar">
      <div class="sidebar-header">
        <h2 id="tool-title">≈ûifreleme Algoritmalarƒ±</h2>
        <button
          onclick="resetMenu()"
          id="back-btn"
          style="
            display: none;
            margin-top: 10px;
            padding: 4px 12px;
            cursor: pointer;
            background: #128c7e;
            border: none;
            color: white;
            border-radius: 4px;
          "
        >
          ‚Üê Men√º
        </button>
      </div>

      <div class="menu-grid" id="menu-box">
        <div
          class="btn-alg btn-monitor"
          onclick="window.open('/server_monitor', '_blank')"
        >
          üöÄ SUNUCU MONƒ∞T√ñR√úN√ú BA≈ûLAT
        </div>

        <div
          class="btn-alg"
          style="background: #e63946"
          onclick="loadTool('/caesar', 'Sezar')"
        >
          Sezar
        </div>

        <div
          class="btn-alg"
          style="background: #457b9d"
          onclick="loadTool('/vigenere', 'Vigenere')"
        >
          Vigenere
        </div>

        <div
          class="btn-alg"
          style="background: #2a9d8f"
          onclick="loadTool('/railfence', 'Rail Fence')"
        >
          Rail Fence
        </div>

        <div
          class="btn-alg"
          style="background: #f4a261"
          onclick="loadTool('/substitution', 'Substitution')"
        >
          Substitution
        </div>

        <div
          class="btn-alg"
          style="background: #8d44ad"
          onclick="loadTool('/hill', 'Hill')"
        >
          Hill
        </div>

        <div
          class="btn-alg"
          style="background: #1d3557"
          onclick="loadTool('/des', 'DES')"
        >
          DES
        </div>

        <div
          class="btn-alg"
          style="background: #264653"
          onclick="loadTool('/aes', 'AES-128')"
        >
          AES-128
        </div>

        <div
          class="btn-alg"
          style="background: #e76f51"
          onclick="loadTool('/columnar', 'Columnar Transposition')"
        >
          Columnar
        </div>

        <div
          class="btn-alg"
          style="background: #6d597a"
          onclick="loadTool('/polybius', 'Polybius')"
        >
          Polybius
        </div>
      </div>

      <iframe id="tool-frame" class="iframe-view"></iframe>
    </div>

    <div class="chat-panel">
      <div class="chat-header">
        <span>üì° TRAFƒ∞K AKI≈ûI</span><span id="status">‚óè Canlƒ±</span>
      </div>
      <div id="chat-window"></div>
    </div>

    <script>
      const socket = io();
      const XOR_KEY = 123;

      function loadTool(url, title) {
        document.getElementById("menu-box").style.display = "none";
        document.getElementById("back-btn").style.display = "inline-block";
        document.getElementById("tool-title").innerText = title;
        const frame = document.getElementById("tool-frame");
        frame.src = url;
        frame.style.display = "block";
      }

      function resetMenu() {
        document.getElementById("menu-box").style.display = "grid";
        document.getElementById("back-btn").style.display = "none";
        document.getElementById("tool-title").innerText =
          "≈ûifreleme Algoritmalarƒ±";
        const frame = document.getElementById("tool-frame");
        frame.style.display = "none";
        frame.src = "";
      }

      window.addMessageToChat = function (text, label, type, method) {
        const win = document.getElementById("chat-window");
        const div = document.createElement("div");
        div.className = `bubble ${type}`;
        const contentLabel =
          type === "client-msg" ? "≈ûifreli Paket:" : "Mesaj:";

        div.innerHTML = `
        <span class="tag">${label} [${method}]</span>
        <div style="word-break:break-all;"><strong>${contentLabel}</strong> ${text}</div>
        <span class="meta">${new Date().toLocaleTimeString()}</span>
    `;
        win.appendChild(div);
        win.scrollTop = win.scrollHeight;
      };

      socket.on("server_to_client", (data) => {
        const packet = data.encrypted_resp;
        if (packet) {
          try {
            const rawXor = atob(packet);
            const decoded = [...rawXor]
              .map((c) => String.fromCharCode(c.charCodeAt(0) ^ XOR_KEY))
              .join("");
            addMessageToChat(decoded, "SUNUCU", "server-msg", data.method);
          } catch (e) {
            console.error("√á√∂zme hatasƒ±:", e);
          }
        }
      });
    </script>
  </body>
</html>
