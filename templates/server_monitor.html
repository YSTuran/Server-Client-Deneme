<!DOCTYPE html>
<html lang="tr">
  <head>
    <meta charset="UTF-8" />
    <title>Server Control Center</title>
    <script src="https://cdn.socket.io/4.0.0/socket.io.min.js"></script>
    <style>
      /* CSS kƒ±sƒ±mlarƒ±n aynƒ± kalƒ±yor, hƒ±zlƒ±ca ge√ßiyorum */
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }
      body {
        font-family: "Segoe UI", sans-serif;
        height: 100vh;
        display: flex;
        background: #0a0a0a;
        color: #eee;
        overflow: hidden;
      }
      .sidebar {
        width: 45%;
        background: #111;
        border-right: 2px solid #333;
        display: flex;
        flex-direction: column;
        position: relative;
        z-index: 10;
      }
      .sidebar-header {
        padding: 20px;
        background: #1a1a1a;
        border-bottom: 2px solid #0f0;
        text-align: center;
      }
      .menu-grid {
        padding: 20px;
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 10px;
        overflow-y: auto;
      }
      .btn-alg {
        padding: 15px;
        border-radius: 8px;
        border: none;
        color: white;
        cursor: pointer;
        font-weight: bold;
        text-align: center;
        font-size: 14px;
        opacity: 0.9;
        transition: 0.2s;
        display: flex;
        align-items: center;
        justify-content: center;
        user-select: none;
      }
      .btn-alg:hover {
        opacity: 1;
        transform: scale(1.02);
        box-shadow: 0 0 10px rgba(0, 255, 0, 0.3);
      }
      .btn-alg:active {
        transform: scale(0.98);
      }
      .iframe-view {
        width: 100%;
        height: 100%;
        border: none;
        display: none;
        background: #fff;
        flex-grow: 1;
      }
      .chat-panel {
        width: 55%;
        display: flex;
        flex-direction: column;
        background: #050505;
        border-left: 1px solid #333;
      }
      .chat-header {
        padding: 15px;
        background: #1a1a1a;
        color: #0f0;
        display: flex;
        justify-content: space-between;
        border-bottom: 1px solid #333;
      }
      #chat-window {
        flex-grow: 1;
        padding: 20px;
        overflow-y: auto;
        display: flex;
        flex-direction: column;
        gap: 10px;
      }
      .bubble {
        max-width: 85%;
        padding: 10px 15px;
        border-radius: 10px;
        font-size: 14px;
        line-height: 1.4;
        position: relative;
        margin-bottom: 5px;
      }
      .incoming {
        align-self: flex-start;
        background: #1f1f1f;
        border: 1px solid #333;
        color: #0f0;
        border-top-left-radius: 0;
      }
      .outgoing {
        align-self: flex-end;
        background: #004d40;
        border: 1px solid #00695c;
        color: #e0f2f1;
        border-top-right-radius: 0;
      }
      .tag {
        font-size: 10px;
        font-weight: bold;
        display: block;
        margin-bottom: 4px;
        text-transform: uppercase;
        opacity: 0.7;
      }
      .meta {
        font-size: 10px;
        color: #888;
        margin-top: 5px;
        text-align: right;
        display: block;
      }
      .highlight {
        color: #fff;
        font-weight: bold;
      }
    </style>
  </head>
  <body>
    <div class="sidebar">
      <div class="sidebar-header">
        <h2 id="tool-title" style="color: #0f0">SUNUCU Y√ñNETƒ∞Mƒ∞</h2>
        <button
          id="back-btn"
          onclick="resetMenu()"
          style="
            display: none;
            margin-top: 10px;
            padding: 5px 15px;
            cursor: pointer;
            background: #333;
            color: #fff;
            border: 1px solid #0f0;
          "
        >
          ‚Üê Men√ºye D√∂n
        </button>
      </div>

      <div class="menu-grid" id="menu-box">
        <div
          class="btn-alg"
          style="background: #e63946"
          onclick="loadTool('/caesar', 'Sezar (Sunucu G√∂nderimi)')"
        >
          Sezar
        </div>

        <div
          class="btn-alg"
          style="background: #457b9d"
          onclick="loadTool('/vigenere', 'Vigenere (Sunucu G√∂nderimi)')"
        >
          Vigenere
        </div>

        <div
          class="btn-alg"
          style="background: #2a9d8f"
          onclick="loadTool('/railfence', 'Rail Fence (Sunucu G√∂nderimi)')"
        >
          Rail Fence
        </div>

        <div
          class="btn-alg"
          style="background: #f4a261"
          onclick="loadTool('/substitution', 'Substitution (Sunucu G√∂nderimi)')"
        >
          Substitution
        </div>

        <div
          class="btn-alg"
          style="background: #8d44ad"
          onclick="loadTool('/hill', 'Hill (Sunucu G√∂nderimi)')"
        >
          Hill
        </div>

        <div
          class="btn-alg"
          style="background: #1d3557"
          onclick="loadTool('/des', 'DES (Sunucu G√∂nderimi)')"
        >
          DES
        </div>

        <div
          class="btn-alg"
          style="background: #264653"
          onclick="loadTool('/aes', 'AES-128 (Sunucu G√∂nderimi)')"
        >
          AES-128
        </div>

        <div
          class="btn-alg"
          style="background: #e76f51"
          onclick="loadTool('/columnar', 'Columnar (Sunucu G√∂nderimi)')"
        >
          Columnar
        </div>

        <div
          class="btn-alg"
          style="background: #6d597a"
          onclick="loadTool('/polybius', 'Polybius (Sunucu G√∂nderimi)')"
        >
          Polybius
        </div>
      </div>

      <iframe id="tool-frame" class="iframe-view"></iframe>
    </div>

    <div class="chat-panel">
      <div class="chat-header">
        <span>üì° CANLI VERƒ∞ ANALƒ∞Zƒ∞</span>
        <span style="color: #fff; font-size: 12px">DURUM: AKTƒ∞F</span>
      </div>
      <div id="chat-window">
        <div
          id="wait-msg"
          style="
            text-align: center;
            color: #333;
            font-size: 12px;
            margin-top: 20px;
          "
        >
          Trafik bekleniyor...
        </div>
      </div>
    </div>

    <script>
      const socket = io();
      const XOR_KEY = 123;

      function base64ToUnicode(str) {
        try {
          return decodeURIComponent(escape(window.atob(str)));
        } catch (e) {
          console.error("Base64 decode hatasƒ±:", e);
          return str;
        }
      }

      function loadTool(url, title) {
        const menuBox = document.getElementById("menu-box");
        const backBtn = document.getElementById("back-btn");
        const toolTitle = document.getElementById("tool-title");
        const frame = document.getElementById("tool-frame");

        if (menuBox) menuBox.style.display = "none";
        if (backBtn) backBtn.style.display = "inline-block";
        if (toolTitle) toolTitle.innerText = title;
        if (frame) {
          frame.src = url;
          frame.style.display = "block";
        }
      }

      function resetMenu() {
        document.getElementById("menu-box").style.display = "grid";
        document.getElementById("back-btn").style.display = "none";
        document.getElementById("tool-title").innerText = "SUNUCU Y√ñNETƒ∞Mƒ∞";
        const frame = document.getElementById("tool-frame");
        frame.style.display = "none";
        frame.src = "";
      }

      async function sendMessage() {
        const msgInput = document.getElementById("message");
        if (!msgInput) return;
        const msg = msgInput.value.trim();
        if (!msg) return;

        socket.emit("server_to_client", {
          method: "Sƒ∞STEM",
          text: msg,
        });

        msgInput.value = "";
      }

      function addLog(text, label, type, method, encrypted = null) {
        const win = document.getElementById("chat-window");
        const waitMsg = document.getElementById("wait-msg");
        if (waitMsg) waitMsg.remove();

        const div = document.createElement("div");
        div.className = `bubble ${type}`;

        let content = `<strong>Mesaj:</strong> ${text}`;
        if (encrypted) {
          content =
            `<div style="font-size:11px; color:#888; margin-bottom:4px;">Paket: ${encrypted}</div>` +
            content;
        }

        div.innerHTML = `
        <span class="tag" style="display:block; font-size:10px; opacity:0.7;">${label} [${method}]</span>
        <div style="word-break:break-all;">${content}</div>
        <span class="meta" style="display:block; font-size:9px; text-align:right; margin-top:4px;">${new Date().toLocaleTimeString()}</span>
    `;

        win.appendChild(div);
        win.scrollTop = win.scrollHeight;
      }

      socket.on("display_on_server", (data) => {
        let decodedText = "[Veri √á√∂z√ºlemedi]";
        try {
          const rawXor = base64ToUnicode(data.text);
          decodedText = [...rawXor]
            .map((c) => String.fromCharCode(c.charCodeAt(0) ^ XOR_KEY))
            .join("");
        } catch (e) {
          console.log(e);
        }

        addLog(
          decodedText,
          "üì• ƒ∞STEMCƒ∞",
          "incoming",
          data.method,
          data.encrypted
        );
      });

      socket.on("server_to_client", (data) => {
        let originalText = "Undefined";
        const packet = data.encrypted_resp;

        if (packet) {
          try {
            const rawXor = base64ToUnicode(packet);
            originalText = [...rawXor]
              .map((c) => String.fromCharCode(c.charCodeAt(0) ^ XOR_KEY))
              .join("");
          } catch (e) {
            console.error("Monitor √ß√∂zme hatasƒ±:", e);
          }
        }
        addLog(
          originalText,
          "üì§ Sƒ∞Z (SUNUCU)",
          "outgoing",
          data.method,
          packet 
        );
      });
    </script>
  </body>
</html>
